import{c as q}from"./commonMixin-CMso4bz3.js";import{_ as M,d as x,w as i,a as l,r as u,f as a,t as d,g as j,D as I,o as g,c as f,b as s,e as w,F as P,z as G,y as L}from"./app-nSw-_BHz.js";const O={name:"PermissionDialog",props:{modelValue:{type:Boolean,default:!1},editingPermission:{type:Object,default:null},saving:{type:Boolean,default:!1},form:{type:Object,required:!0},rules:{type:Object,default:()=>({})},groups:{type:Array,default:()=>[]},newGroup:{type:String,default:""},autoGenerateSlugFromName:{type:Function,required:!0}},emits:["update:modelValue","update:newGroup","save","close","add-group"],computed:{dialogValue:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},newGroupValue:{get(){return this.newGroup},set(t){this.$emit("update:newGroup",t)}}},methods:{validateForm(){var t,e;return(e=(t=this.$refs.permissionForm)==null?void 0:t.validate)==null?void 0:e.call(t)},resetValidation(){var t,e;(e=(t=this.$refs.permissionForm)==null?void 0:t.resetValidation)==null||e.call(t)}}};function Q(t,e,p,D,n,r){const y=u("v-card-title"),V=u("v-text-field"),k=u("v-list-item"),F=u("v-select"),N=u("v-textarea"),C=u("v-form"),S=u("v-card-text"),_=u("v-spacer"),z=u("v-btn"),v=u("v-card-actions"),U=u("v-card"),c=u("v-dialog");return g(),x(c,{modelValue:r.dialogValue,"onUpdate:modelValue":e[9]||(e[9]=m=>r.dialogValue=m),"max-width":"600",persistent:""},{default:i(()=>[l(U,null,{default:i(()=>[l(y,null,{default:i(()=>[a(d(p.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),l(S,null,{default:i(()=>[l(C,{ref:"permissionForm",onSubmit:e[6]||(e[6]=j(m=>t.$emit("save"),["prevent"]))},{default:i(()=>[l(V,{modelValue:p.form.name,"onUpdate:modelValue":e[0]||(e[0]=m=>p.form.name=m),label:"Permission Name",rules:[p.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",variant:"outlined",placeholder:"e.g., Manage Users",onBlur:p.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),l(V,{modelValue:p.form.slug,"onUpdate:modelValue":e[1]||(e[1]=m=>p.form.slug=m),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4",variant:"outlined",placeholder:"e.g., manage-users"},null,8,["modelValue"]),l(F,{modelValue:p.form.group,"onUpdate:modelValue":e[4]||(e[4]=m=>p.form.group=m),items:p.groups,"item-title":m=>typeof m=="string"?m:m.name,"item-value":m=>typeof m=="string"?m:m.name,label:"Group",rules:[p.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4",variant:"outlined",placeholder:"Select group"},{"append-item":i(()=>[l(k,null,{default:i(()=>[l(V,{modelValue:r.newGroupValue,"onUpdate:modelValue":e[2]||(e[2]=m=>r.newGroupValue=m),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",hint:"Press Enter to add","persistent-hint":"",placeholder:"New group name",onKeyup:e[3]||(e[3]=I(m=>t.$emit("add-group"),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","items","item-title","item-value","rules"]),l(N,{modelValue:p.form.description,"onUpdate:modelValue":e[5]||(e[5]=m=>p.form.description=m),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4",variant:"outlined",placeholder:"Describe the permission"},null,8,["modelValue"])]),_:1},512)]),_:1}),l(v,null,{default:i(()=>[l(_),l(z,{onClick:e[7]||(e[7]=m=>t.$emit("close")),variant:"text"},{default:i(()=>e[10]||(e[10]=[a("Cancel")])),_:1,__:[10]}),l(z,{onClick:e[8]||(e[8]=m=>t.$emit("save")),color:"primary",loading:p.saving},{default:i(()=>[a(d(p.editingPermission?"Update":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const H=M(O,[["render",Q]]),R={components:{PermissionDialog:H},mixins:[q],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null,newGroup:"",form:{name:"",slug:"",group:"",description:""},rules:{required:t=>!!t||"This field is required"}}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const t={};this.searchQuery&&(t.search=this.searchQuery),this.selectedGroup&&(t.group=this.selectedGroup),this.viewMode==="grouped"?t.grouped=!0:(t.page=this.currentPage,t.per_page=this.perPage);const e=await this.$axios.get("/api/v1/permissions",{params:t,headers:this.getAuthHeaders()});this.viewMode==="grouped"?(this.groupedPermissions=e.data,this.permissions=[],Object.values(e.data).forEach(p=>{this.permissions.push(...p)}),this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}):(e.data.data?(this.permissions=e.data.data||[],this.pagination={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total}):(this.permissions=e.data||[],this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}),this.groupedPermissions={},this.permissions.forEach(p=>{this.groupedPermissions[p.group]||(this.groupedPermissions[p.group]=[]),this.groupedPermissions[p.group].push(p)}))}catch(t){this.handleApiError(t,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const t=await this.$axios.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});t.data&&t.data.length>0?typeof t.data[0]=="string"?this.groups=t.data.map(e=>({name:e,permissions_count:0})):this.groups=t.data:this.groups=[]}catch(t){console.error("Error loading groups:",t),this.groups=[]}},openDialog(t){t?(this.editingPermission=t,this.form={name:t.name,slug:t.slug,group:t.group,description:t.description||""}):(this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""}),this.dialog=!0},closeDialog(){var t,e;this.dialog=!1,this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""},(e=(t=this.$refs.permissionDialog)==null?void 0:t.resetValidation)==null||e.call(t)},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){if(this.newGroup&&!this.groups.find(t=>t.name===this.newGroup||typeof t=="string"&&t===this.newGroup)){const t=this.newGroup.trim();this.groups.push({name:t,permissions_count:0}),this.form.group=t,this.newGroup=""}},async savePermission(){var t;if(!((t=this.$refs.permissionDialog)!=null&&t.validateForm)){this.showError("Form reference not found");return}if(this.$refs.permissionDialog.validateForm()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const e=this.editingPermission?`/api/v1/permissions/${this.editingPermission.id}`:"/api/v1/permissions",p=this.editingPermission?"put":"post",D={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await this.$axios[p](e,D,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.closeDialog(),await this.loadGroups(),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error saving permission")}finally{this.saving=!1}}},async deletePermission(t){if((t.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${t.name}"?`))try{await this.$axios.delete(`/api/v1/permissions/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(t){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[t]||"grey"},onPerPageChange(){this.resetPagination(),this.loadPermissions()},onSort(t){this.handleSort(t),this.loadPermissions()},filterByGroup(t){this.selectedGroup===t?this.clearGroupFilter():(this.selectedGroup=t,this.resetPagination(),this.loadPermissions())},clearGroupFilter(){this.selectedGroup=null,this.resetPagination(),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},T={class:"page-header"},K={class:"d-flex align-center flex-wrap",style:{gap:"8px"}},J={class:"text-caption text-grey"},W={key:0},X={key:0},Y={class:"text-h6 mb-3"},Z={class:"d-flex align-center"},$={class:"d-flex align-center"},ee={class:"d-flex"},te={class:"font-weight-medium"},se={class:"text-caption text-grey"},le={class:"d-flex align-center"},oe={class:"d-flex align-center"},ie={class:"d-flex align-center"},ne={class:"d-flex"},re={class:"font-weight-medium"},ae={class:"text-caption text-grey"},de={key:0},ue={key:2,class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},me={class:"text-caption text-grey"},pe={key:0},ge={key:0,class:"ml-2"},fe={key:1},ce={key:0,class:"d-flex align-center gap-2"};function he(t,e,p,D,n,r){const y=u("v-btn"),V=u("v-select"),k=u("v-col"),F=u("v-text-field"),N=u("v-row"),C=u("v-card-text"),S=u("v-card"),_=u("v-icon"),z=u("v-btn-toggle"),v=u("v-chip"),U=u("v-card-title"),c=u("v-skeleton-loader"),m=u("v-table"),A=u("v-pagination"),E=u("PermissionDialog");return g(),f("div",null,[s("div",T,[e[14]||(e[14]=s("h1",{class:"text-h4 page-title"},"Permission Management",-1)),l(y,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>r.openDialog(null)),class:"add-button"},{default:i(()=>e[13]||(e[13]=[a(" Add New Permission ")])),_:1,__:[13]})]),l(S,{class:"mb-4"},{default:i(()=>[l(C,null,{default:i(()=>[l(N,null,{default:i(()=>[n.viewMode==="flat"?(g(),x(k,{key:0,cols:"12",md:"2"},{default:i(()=>[l(V,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=o=>t.perPage=o),r.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})):w("",!0),l(k,{cols:"12",md:n.viewMode==="flat"?4:6},{default:i(()=>[l(V,{modelValue:n.selectedGroup,"onUpdate:modelValue":[e[2]||(e[2]=o=>n.selectedGroup=o),r.loadPermissions],items:n.groups,"item-title":o=>typeof o=="string"?o:o.name,"item-value":o=>typeof o=="string"?o:o.name,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","item-title","item-value","onUpdate:modelValue"])]),_:1},8,["md"]),l(k,{cols:"12",md:n.viewMode==="flat"?6:8},{default:i(()=>[l(F,{modelValue:n.searchQuery,"onUpdate:modelValue":[e[3]||(e[3]=o=>n.searchQuery=o),r.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["md"])]),_:1})]),_:1})]),_:1}),l(S,{class:"mb-4"},{default:i(()=>[l(C,{class:"py-3"},{default:i(()=>[s("div",K,[l(z,{modelValue:n.viewMode,"onUpdate:modelValue":e[4]||(e[4]=o=>n.viewMode=o),mandatory:"",density:"compact",class:"mr-4"},{default:i(()=>[l(y,{value:"flat",size:"small"},{default:i(()=>[l(_,{start:""},{default:i(()=>e[15]||(e[15]=[a("mdi-format-list-bulleted")])),_:1,__:[15]}),e[16]||(e[16]=a(" Flat View "))]),_:1,__:[16]}),l(y,{value:"grouped",size:"small"},{default:i(()=>[l(_,{start:""},{default:i(()=>e[17]||(e[17]=[a("mdi-folder")])),_:1,__:[17]}),e[18]||(e[18]=a(" Grouped View "))]),_:1,__:[18]})]),_:1},8,["modelValue"]),e[20]||(e[20]=s("span",{class:"text-caption text-grey mr-2"},"Filter by Group:",-1)),(g(!0),f(P,null,G(n.groups,o=>(g(),x(v,{key:o.name,color:r.getGroupColor(o.name),size:"small",variant:n.selectedGroup===o.name?"flat":"outlined",class:L([{"font-weight-bold":n.selectedGroup===o.name},"group-filter-chip"]),onClick:b=>r.filterByGroup(o.name),style:{cursor:"pointer"}},{default:i(()=>[a(d(o.name)+" ",1),l(v,{size:"x-small",color:n.selectedGroup===o.name?"white":r.getGroupColor(o.name),variant:"flat",class:"ml-2"},{default:i(()=>[a(d(o.permissions_count||0),1)]),_:2},1032,["color"])]),_:2},1032,["color","variant","class","onClick"]))),128)),n.selectedGroup?(g(),x(v,{key:0,size:"small",color:"grey",variant:"text","prepend-icon":"mdi-close",onClick:r.clearGroupFilter,style:{cursor:"pointer"},class:"ml-2"},{default:i(()=>e[19]||(e[19]=[a(" Clear Filter ")])),_:1,__:[19]},8,["onClick"])):w("",!0)])]),_:1})]),_:1}),l(S,null,{default:i(()=>[l(U,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[22]||(e[22]=s("span",null,"Permissions",-1)),s("span",J,[e[21]||(e[21]=a(" Total Records: ")),s("strong",null,d(t.pagination.total||0),1),n.permissions.length>0&&n.viewMode==="flat"?(g(),f("span",W," | Showing "+d((t.currentPage-1)*t.perPage+1)+" to "+d(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+d(t.pagination.total),1)):w("",!0)])]),_:1,__:[22]}),l(C,null,{default:i(()=>[n.viewMode==="grouped"?(g(),f("div",X,[(g(!0),f(P,null,G(n.groupedPermissions,(o,b)=>(g(),f("div",{key:b,class:"mb-6"},[s("h3",Y,[a(d(b.charAt(0).toUpperCase()+b.slice(1))+" ",1),l(v,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:i(()=>[a(d(o.length)+" permission"+d(o.length!==1?"s":""),1)]),_:2},1024)]),l(m,null,{default:i(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[5]||(e[5]=h=>r.onSort("name"))},[s("div",Z,[e[23]||(e[23]=a(" Name ")),l(_,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[6]||(e[6]=h=>r.onSort("slug"))},[s("div",$,[e[24]||(e[24]=a(" Slug ")),l(_,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[25]||(e[25]=s("th",null,"Description",-1)),e[26]||(e[26]=s("th",null,"Roles",-1)),e[27]||(e[27]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(g(),f(P,{key:0},G(5,h=>s("tr",{key:`skeleton-grouped-${h}`},[s("td",null,[l(c,{type:"text",width:"150"})]),s("td",null,[l(c,{type:"chip",width:"120",height:"24"})]),s("td",null,[l(c,{type:"text",width:"200"})]),s("td",null,[l(c,{type:"chip",width:"60",height:"24"})]),s("td",null,[s("div",ee,[l(c,{type:"button",width:"32",height:"32",class:"mr-1"}),l(c,{type:"button",width:"32",height:"32"})])])])),64)):(g(!0),f(P,{key:1},G(o,h=>(g(),f("tr",{key:h.id},[s("td",null,[s("div",te,d(h.name),1)]),s("td",null,[l(v,{size:"small",variant:"outlined"},{default:i(()=>[a(d(h.slug),1)]),_:2},1024)]),s("td",null,[s("span",se,d(h.description||"No description"),1)]),s("td",null,[l(v,{size:"small",color:"info",variant:"text"},{default:i(()=>[a(d(h.roles_count||0)+" role"+d((h.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),s("td",null,[l(y,{size:"small",icon:"mdi-pencil",onClick:B=>r.openDialog(h),variant:"text"},null,8,["onClick"]),l(y,{size:"small",icon:"mdi-delete",onClick:B=>r.deletePermission(h),variant:"text",color:"error",disabled:(h.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(g(),x(m,{key:1},{default:i(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[7]||(e[7]=o=>r.onSort("name"))},[s("div",le,[e[28]||(e[28]=a(" Name ")),l(_,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[8]||(e[8]=o=>r.onSort("slug"))},[s("div",oe,[e[29]||(e[29]=a(" Slug ")),l(_,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[9]||(e[9]=o=>r.onSort("group"))},[s("div",ie,[e[30]||(e[30]=a(" Group ")),l(_,{icon:t.getSortIcon("group"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[31]||(e[31]=s("th",null,"Description",-1)),e[32]||(e[32]=s("th",null,"Roles",-1)),e[33]||(e[33]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(g(),f(P,{key:0},G(5,o=>s("tr",{key:`skeleton-flat-${o}`},[s("td",null,[l(c,{type:"text",width:"150"})]),s("td",null,[l(c,{type:"chip",width:"120",height:"24"})]),s("td",null,[l(c,{type:"chip",width:"100",height:"24"})]),s("td",null,[l(c,{type:"text",width:"200"})]),s("td",null,[l(c,{type:"chip",width:"60",height:"24"})]),s("td",null,[s("div",ne,[l(c,{type:"button",width:"32",height:"32",class:"mr-1"}),l(c,{type:"button",width:"32",height:"32"})])])])),64)):(g(),f(P,{key:1},[(g(!0),f(P,null,G(n.permissions,o=>(g(),f("tr",{key:o.id},[s("td",null,[s("div",re,d(o.name),1)]),s("td",null,[l(v,{size:"small",variant:"outlined"},{default:i(()=>[a(d(o.slug),1)]),_:2},1024)]),s("td",null,[l(v,{size:"small",color:r.getGroupColor(o.group)},{default:i(()=>[a(d(o.group),1)]),_:2},1032,["color"])]),s("td",null,[s("span",ae,d(o.description||"No description"),1)]),s("td",null,[l(v,{size:"small",color:"info",variant:"text"},{default:i(()=>[a(d(o.roles_count||0)+" role"+d((o.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),s("td",null,[l(y,{size:"small",icon:"mdi-pencil",onClick:b=>r.openDialog(o),variant:"text"},null,8,["onClick"]),l(y,{size:"small",icon:"mdi-delete",onClick:b=>r.deletePermission(o),variant:"text",color:"error",disabled:(o.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),n.permissions.length===0?(g(),f("tr",de,e[34]||(e[34]=[s("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)]))):w("",!0)],64))])]),_:1})),n.viewMode==="flat"?(g(),f("div",ue,[s("div",me,[n.permissions.length>0&&t.pagination.total>0?(g(),f("span",pe,[e[35]||(e[35]=a(" Showing ")),s("strong",null,d((t.currentPage-1)*t.perPage+1),1),e[36]||(e[36]=a(" to ")),s("strong",null,d(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[37]||(e[37]=a(" of ")),s("strong",null,d(t.pagination.total.toLocaleString()),1),e[38]||(e[38]=a(" records ")),t.pagination.last_page>1?(g(),f("span",ge," (Page "+d(t.currentPage)+" of "+d(t.pagination.last_page)+") ",1)):w("",!0)])):(g(),f("span",fe," No records found "))]),t.pagination.last_page>1?(g(),f("div",ce,[l(A,{modelValue:t.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=o=>t.currentPage=o),r.loadPermissions],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):w("",!0)])):w("",!0)]),_:1})]),_:1}),l(E,{ref:"permissionDialog",modelValue:n.dialog,"onUpdate:modelValue":e[11]||(e[11]=o=>n.dialog=o),"editing-permission":n.editingPermission,saving:t.saving,form:n.form,rules:n.rules,groups:n.groups,"new-group":n.newGroup,"onUpdate:newGroup":e[12]||(e[12]=o=>n.newGroup=o),"auto-generate-slug-from-name":r.autoGenerateSlugFromName,onAddGroup:r.addNewGroup,onSave:r.savePermission,onClose:r.closeDialog},null,8,["modelValue","editing-permission","saving","form","rules","groups","new-group","auto-generate-slug-from-name","onAddGroup","onSave","onClose"])])}const _e=M(R,[["render",he]]);export{_e as default};
