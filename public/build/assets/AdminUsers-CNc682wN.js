import{c as G}from"./commonMixin-CMso4bz3.js";import{r as J,n as W}from"./uploads-CnEkgyD_.js";import{_ as B,c as p,a as l,w as s,r as d,m as Z,o as m,d as F,f,t as h,g as K,b as n,e as b,A as Q,B as X,C as $,F as A,z as q}from"./app-nSw-_BHz.js";import{U as ee}from"./UserProfileDialog-B9OlLxiP.js";import"./moment-C5S46NFB.js";function te(t,e="long"){if(!t)return"";const a=new Date(t);if(isNaN(a.getTime()))return"";if(e==="DD/MM/YYYY"){const c=String(a.getDate()).padStart(2,"0"),o=String(a.getMonth()+1).padStart(2,"0"),i=a.getFullYear();return`${c}/${o}/${i}`}if(e==="MM/DD/YYYY"){const c=String(a.getDate()).padStart(2,"0"),o=String(a.getMonth()+1).padStart(2,"0"),i=a.getFullYear();return`${o}/${c}/${i}`}return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(a)}const ae={props:["fieldLabel","required","variant","min","initialDate","hint","persistentHint","rules"],data(){return{isMenuOpen:null,selectedDate:this.initialDate==null?null:new Date(this.initialDate),dbFormatDate:null,dateFieldLavel:this.fieldLabel??"Selected date",fieldPlaceHolder:"Enter "+this.fieldLabel,yesterdayIso:new Date(new Date().setDate(new Date().getDate()-1))}},computed:{computedCustomValue(){if(this.selectedDate)return this.frmtInsideDate(this.selectedDate)},mergedRules(){const t=Array.isArray(this.rules)?this.rules:[],e=this.required?a=>!!a||`This ${this.dateFieldLavel} is required`:null;return[...t,e].filter(Boolean)}},watch:{computedCustomValue:function(t){t&&this.dbFormatDate!==null&&this.$emit("trigerInputValue",this.dbFormatDate)},initialDate:function(t){t?(this.selectedDate=new Date(t),this.$nextTick(()=>{this.computedCustomValue&&this.dbFormatDate&&this.$emit("trigerInputValue",this.dbFormatDate)})):(this.selectedDate=null,this.dbFormatDate=null,this.$emit("trigerInputValue",null))}},mounted(){this.initialDate&&this.selectedDate&&this.$nextTick(()=>{this.computedCustomValue&&this.dbFormatDate&&this.$emit("trigerInputValue",this.dbFormatDate)})},methods:{onClear(){this.selectedDate=null,this.dbFormatDate=null,this.$emit("trigerInputValue",null)},frmtInsideDate(t){const e=new Date(t),a=e.getDate(),c=e.getMonth()+1,o=e.getFullYear(),i=a.toString().padStart(2,"0"),g=c.toString().padStart(2,"0"),y=`${i}/${g}/${o}`;return this.dbFormatDate=`${o}-${g}-${i}`,y}}};function le(t,e,a,c,o,i){const g=d("v-text-field"),y=d("v-date-picker"),_=d("v-menu");return m(),p("div",null,[l(_,{modelValue:o.isMenuOpen,"onUpdate:modelValue":e[3]||(e[3]=v=>o.isMenuOpen=v),"close-on-content-click":!1},{activator:s(({props:v})=>[l(g,Z({label:o.dateFieldLavel,placeholder:o.fieldPlaceHolder,"model-value":i.computedCustomValue,readonly:""},v,{clearable:"","onClick:clear":e[0]||(e[0]=D=>i.onClear()),density:"compact",hint:a.hint,"persistent-hint":a.persistentHint,class:a.required?"required":null,variant:a.variant?a.variant:"underlined",rules:i.mergedRules}),null,16,["label","placeholder","model-value","hint","persistent-hint","class","variant","rules"])]),default:s(()=>[l(y,{"show-adjacent-months":"","hide-header":"","hide-actions":"",position:"sticky",modelValue:o.selectedDate,"onUpdate:modelValue":[e[1]||(e[1]=v=>o.selectedDate=v),e[2]||(e[2]=v=>(o.isMenuOpen=!1,a.initialDate=null))],min:a.min?o.yesterdayIso:null},null,8,["modelValue","min"])]),_:1},8,["modelValue"])])}const oe=B(ae,[["render",le]]),se={name:"UserDialog",components:{DatePickerVuetifyInput:oe},computed:{todayDate(){return new Date().toISOString().slice(0,10)}},props:{modelValue:{type:Boolean,default:!1},editingUser:{type:Object,default:null},saving:{type:Boolean,default:!1},form:{type:Object,required:!0},roles:{type:Array,default:()=>[]},rules:{type:Object,default:()=>({})},activeTab:{type:String,default:"basic"},genderOptions:{type:Array,default:()=>[]},showPassword:{type:Boolean,default:!1},showPasswordConfirmation:{type:Boolean,default:!1},avatarFile:{type:[Array,Object],default:null},uploadingAvatar:{type:Boolean,default:!1},resolveImageUrl:{type:Function,required:!0}},emits:["update:modelValue","update:activeTab","update:showPassword","update:showPasswordConfirmation","update:avatarFile","save","close","clear-avatar","avatar-upload"],computed:{dialogValue:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},activeTabValue:{get(){return this.activeTab},set(t){this.$emit("update:activeTab",t)}},avatarFileValue:{get(){return this.avatarFile},set(t){this.$emit("update:avatarFile",t)}}},methods:{validateForm(){var t,e;return(e=(t=this.$refs.form)==null?void 0:t.validate)==null?void 0:e.call(t)},resetValidation(){var t,e;(e=(t=this.$refs.form)==null?void 0:t.resetValidation)==null||e.call(t)},toggleShowPassword(){this.$emit("update:showPassword",!this.showPassword)},onAvatarFileUpdate(t){this.$emit("update:avatarFile",t),this.$nextTick(()=>{this.$emit("avatar-upload")})}}},re={class:"pa-6"},ne={key:1,class:"text-grey text-caption align-self-center"},ie={class:"mb-4"},de={key:0,class:"mb-3 text-center"},ue={class:"pa-6"},me={class:"pa-6"};function ce(t,e,a,c,o,i){const g=d("v-card-title"),y=d("v-tab"),_=d("v-tabs"),v=d("v-text-field"),D=d("v-chip"),S=d("v-list-item"),x=d("v-select"),z=d("v-img"),P=d("v-avatar"),w=d("v-btn"),M=d("v-progress-circular"),T=d("v-file-input"),C=d("v-window-item"),V=d("v-col"),E=d("DatePickerVuetifyInput"),I=d("v-textarea"),Y=d("v-row"),r=d("v-icon"),U=d("v-window"),O=d("v-form"),R=d("v-card-text"),N=d("v-spacer"),L=d("v-card-actions"),j=d("v-card"),H=d("v-dialog");return m(),F(H,{modelValue:i.dialogValue,"onUpdate:modelValue":e[20]||(e[20]=u=>i.dialogValue=u),"max-width":"900",scrollable:"",persistent:""},{default:s(()=>[l(j,null,{default:s(()=>[l(g,null,{default:s(()=>[f(h(a.editingUser?"Edit User":"Add New User"),1)]),_:1}),l(R,{class:"pa-0"},{default:s(()=>[l(O,{ref:"form",onSubmit:e[17]||(e[17]=K(u=>t.$emit("save"),["prevent"]))},{default:s(()=>[l(_,{modelValue:i.activeTabValue,"onUpdate:modelValue":e[0]||(e[0]=u=>i.activeTabValue=u),"bg-color":"grey-lighten-4"},{default:s(()=>[l(y,{value:"basic"},{default:s(()=>e[21]||(e[21]=[f("Basic Information")])),_:1,__:[21]}),l(y,{value:"profile"},{default:s(()=>e[22]||(e[22]=[f("Profile Information")])),_:1,__:[22]}),l(y,{value:"security"},{default:s(()=>e[23]||(e[23]=[f("Security")])),_:1,__:[23]})]),_:1},8,["modelValue"]),l(U,{modelValue:i.activeTabValue,"onUpdate:modelValue":e[16]||(e[16]=u=>i.activeTabValue=u)},{default:s(()=>[l(C,{value:"basic"},{default:s(()=>[n("div",re,[l(v,{modelValue:a.form.name,"onUpdate:modelValue":e[1]||(e[1]=u=>a.form.name=u),label:"Full Name",rules:[a.rules.required],required:"",class:"mb-4",variant:"outlined",hint:"Enter the user's full name","persistent-hint":"",placeholder:"e.g., Jane Doe"},null,8,["modelValue","rules"]),l(v,{modelValue:a.form.email,"onUpdate:modelValue":e[2]||(e[2]=u=>a.form.email=u),label:"Email",type:"email",rules:[a.rules.required,a.rules.email],required:"",class:"mb-4",variant:"outlined",hint:"Use a valid email address","persistent-hint":"",placeholder:"name@example.com"},null,8,["modelValue","rules"]),l(x,{modelValue:a.form.role_ids,"onUpdate:modelValue":e[3]||(e[3]=u=>a.form.role_ids=u),items:a.roles,"item-title":"label","item-value":"value",label:"Roles",rules:[a.rules.required],required:"",multiple:"",chips:"",class:"mb-4",variant:"outlined",hint:"Select one or more roles","persistent-hint":"",placeholder:"Select roles"},{item:s(({props:u,item:k})=>[l(S,Q(X(u)),{title:s(()=>[f(h(k.raw.label)+" ",1),k.raw.is_system?(m(),F(D,{key:0,size:"x-small",color:"warning",class:"ml-2"},{default:s(()=>e[24]||(e[24]=[f(" System ")])),_:1,__:[24]})):b("",!0)]),subtitle:s(()=>[f(h(k.raw.description),1)]),_:2},1040)]),selection:s(({item:u,index:k})=>[k<2?(m(),F(D,{key:0,size:"small",class:"mr-1"},{default:s(()=>[f(h(u.raw.label),1)]),_:2},1024)):b("",!0),k===2?(m(),p("span",ne," (+"+h(a.form.role_ids.length-2)+" others) ",1)):b("",!0)]),_:1},8,["modelValue","items","rules"]),n("div",ie,[e[26]||(e[26]=n("div",{class:"text-subtitle-2 font-weight-medium mb-2"},"Avatar",-1)),a.form.avatar?(m(),p("div",de,[l(P,{size:"80",class:"mb-2"},{default:s(()=>[l(z,{src:a.form.avatar?a.resolveImageUrl(a.form.avatar):"",alt:"Avatar Preview"},null,8,["src"])]),_:1}),n("div",null,[l(w,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-delete",onClick:e[4]||(e[4]=u=>t.$emit("clear-avatar"))},{default:s(()=>e[25]||(e[25]=[f("Remove Avatar")])),_:1,__:[25]})])])):b("",!0),l(T,{"model-value":i.avatarFileValue,label:"Upload Avatar",variant:"outlined",density:"comfortable",color:"primary",accept:"image/*","prepend-icon":"mdi-image",hint:"Upload an avatar image (JPG, PNG, GIF, WebP - Max 5MB). Recommended size: 200x200px","persistent-hint":"","show-size":"","onUpdate:modelValue":i.onAvatarFileUpdate,class:"mb-3",placeholder:"Choose an image"},$({_:2},[a.uploadingAvatar?{name:"append-inner",fn:s(()=>[l(M,{indeterminate:"",size:"20",color:"primary"})]),key:"0"}:void 0]),1032,["model-value","onUpdate:modelValue"])])])]),_:1}),l(C,{value:"profile"},{default:s(()=>[n("div",ue,[l(Y,null,{default:s(()=>[l(V,{cols:"12",md:"6"},{default:s(()=>[l(v,{modelValue:a.form.phone,"onUpdate:modelValue":e[5]||(e[5]=u=>a.form.phone=u),label:"Phone Number",variant:"outlined","prepend-inner-icon":"mdi-phone",hint:"e.g., +8801707080401","persistent-hint":"",placeholder:"+1 555 123 4567"},null,8,["modelValue"])]),_:1}),l(V,{cols:"12",md:"6"},{default:s(()=>[l(E,{fieldLabel:"Date of Birth","initial-date":a.form.date_of_birth||i.todayDate,variant:"outlined",hint:"YYYY-MM-DD","persistent-hint":!0,onTrigerInputValue:e[6]||(e[6]=u=>a.form.date_of_birth=u)},null,8,["initial-date"])]),_:1}),l(V,{cols:"12",md:"6"},{default:s(()=>[l(x,{modelValue:a.form.gender,"onUpdate:modelValue":e[7]||(e[7]=u=>a.form.gender=u),items:a.genderOptions,label:"Gender",variant:"outlined","prepend-inner-icon":"mdi-gender-male-female",clearable:"",hint:"Optional","persistent-hint":"",placeholder:"Select gender"},null,8,["modelValue","items"])]),_:1}),l(V,{cols:"12"},{default:s(()=>[l(I,{modelValue:a.form.address,"onUpdate:modelValue":e[8]||(e[8]=u=>a.form.address=u),label:"Address",variant:"outlined",rows:"2","prepend-inner-icon":"mdi-map-marker",hint:"Street address","persistent-hint":"",placeholder:"Street address"},null,8,["modelValue"])]),_:1}),l(V,{cols:"12",md:"4"},{default:s(()=>[l(v,{modelValue:a.form.city,"onUpdate:modelValue":e[9]||(e[9]=u=>a.form.city=u),label:"City",variant:"outlined","prepend-inner-icon":"mdi-city",hint:"City or town","persistent-hint":"",placeholder:"City"},null,8,["modelValue"])]),_:1}),l(V,{cols:"12",md:"4"},{default:s(()=>[l(v,{modelValue:a.form.state,"onUpdate:modelValue":e[10]||(e[10]=u=>a.form.state=u),label:"State/Province",variant:"outlined","prepend-inner-icon":"mdi-map",hint:"State or province","persistent-hint":"",placeholder:"State/Province"},null,8,["modelValue"])]),_:1}),l(V,{cols:"12",md:"4"},{default:s(()=>[l(v,{modelValue:a.form.country,"onUpdate:modelValue":e[11]||(e[11]=u=>a.form.country=u),label:"Country",variant:"outlined","prepend-inner-icon":"mdi-flag",hint:"Country name","persistent-hint":"",placeholder:"Country"},null,8,["modelValue"])]),_:1}),l(V,{cols:"12",md:"4"},{default:s(()=>[l(v,{modelValue:a.form.postal_code,"onUpdate:modelValue":e[12]||(e[12]=u=>a.form.postal_code=u),label:"Postal Code",variant:"outlined","prepend-inner-icon":"mdi-mailbox",hint:"ZIP or postal code","persistent-hint":"",placeholder:"ZIP / Postal code"},null,8,["modelValue"])]),_:1}),l(V,{cols:"12"},{default:s(()=>[l(I,{modelValue:a.form.bio,"onUpdate:modelValue":e[13]||(e[13]=u=>a.form.bio=u),label:"Bio",variant:"outlined",rows:"4","prepend-inner-icon":"mdi-text",hint:"Brief description about the user","persistent-hint":"",counter:1e3,placeholder:"Short bio about the user"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),l(C,{value:"security"},{default:s(()=>[n("div",me,[l(v,{modelValue:a.form.password,"onUpdate:modelValue":e[14]||(e[14]=u=>a.form.password=u),label:"Password",type:a.showPassword?"text":"password",rules:a.editingUser?[]:[a.rules.required,a.rules.minLength],required:!a.editingUser,hint:"Leave blank to keep current password","persistent-hint":"",class:"mb-4","prepend-inner-icon":"mdi-lock",variant:"outlined",placeholder:"Enter password"},{"append-inner":s(()=>[l(w,{icon:"",variant:"text",size:"small",onClick:i.toggleShowPassword},{default:s(()=>[l(r,null,{default:s(()=>[f(h(a.showPassword?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","type","rules","required"]),!a.editingUser||a.form.password?(m(),F(v,{key:0,modelValue:a.form.password_confirmation,"onUpdate:modelValue":e[15]||(e[15]=u=>a.form.password_confirmation=u),label:"Confirm Password",type:a.showPasswordConfirmation?"text":"password",rules:a.form.password?[()=>!!a.form.password_confirmation||"Please confirm your password",()=>a.form.password_confirmation===a.form.password||"Passwords do not match"]:[],required:!!a.form.password,"prepend-inner-icon":"mdi-lock-check",variant:"outlined",hint:"Re-enter the password","persistent-hint":"",placeholder:"Re-enter password"},null,8,["modelValue","type","rules","required"])):b("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1},512)]),_:1}),l(L,null,{default:s(()=>[l(N),l(w,{onClick:e[18]||(e[18]=u=>t.$emit("close")),variant:"text"},{default:s(()=>e[27]||(e[27]=[f("Cancel")])),_:1,__:[27]}),l(w,{onClick:e[19]||(e[19]=u=>t.$emit("save")),color:"primary",loading:a.saving},{default:s(()=>[f(h(a.editingUser?"Update":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const pe=B(se,[["render",ce]]),fe={components:{UserDialog:pe,UserProfileDialog:ee},mixins:[G],data(){return{users:[],roles:[],roleFilter:null,roleOptions:[],dialog:!1,editingUser:null,saving:!1,form:{name:"",email:"",role_ids:[],password:"",password_confirmation:"",avatar:"",phone:"",date_of_birth:"",gender:null,address:"",city:"",state:"",country:"",postal_code:"",bio:""},activeTab:"basic",genderOptions:[{title:"Male",value:"male"},{title:"Female",value:"female"},{title:"Other",value:"other"}],rules:{required:t=>Array.isArray(t)?t.length>0||"At least one role is required":!!t||"This field is required",email:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Invalid email",minLength:t=>t?t.length>=8||"Password must be at least 8 characters":!0},currentUserId:null,showPassword:!1,showPasswordConfirmation:!1,avatarFile:null,uploadingAvatar:!1,profileDialogVisible:!1,selectedUser:null}},async mounted(){await this.loadRoles(),await this.loadUsers(),this.loadCurrentUser()},methods:{async loadUsers(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.roleFilter&&(t.role=this.roleFilter);const e=await this.$axios.get("/api/v1/users",{params:t,headers:this.getAuthHeaders()}),a=e.data.data||[];this.users=a,this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load users")}finally{this.loading=!1}},async loadRoles(){try{const t=await this.$axios.get("/api/v1/users/roles",{headers:this.getAuthHeaders()});this.roles=t.data.roles,this.roleOptions=this.roles.map(e=>({title:e.label,value:e.value}))}catch(t){console.error("Error loading roles:",t)}},loadCurrentUser(){const t=localStorage.getItem("admin_token");this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${t}`}}).then(e=>{this.currentUserId=e.data.id}).catch(()=>{})},openDialog(t){if(this.avatarFile=null,this.activeTab="basic",t){this.editingUser=t;const e=t.roles?t.roles.map(c=>c.id):[],a=this.normalizeImageInput(t.avatar||"");this.form={name:t.name||"",email:t.email||"",role_ids:e,password:"",password_confirmation:"",avatar:a,phone:t.phone||"",date_of_birth:t.date_of_birth||"",gender:t.gender||null,address:t.address||"",city:t.city||"",state:t.state||"",country:t.country||"",postal_code:t.postal_code||"",bio:t.bio||""}}else{this.editingUser=null;const e=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:e?[e]:[],password:"",password_confirmation:"",avatar:"",phone:"",date_of_birth:"",gender:null,address:"",city:"",state:"",country:"",postal_code:"",bio:""}}this.dialog=!0},closeDialog(){var e,a;this.dialog=!1,this.editingUser=null,this.activeTab="basic";const t=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:t?[t]:[],password:"",password_confirmation:"",avatar:"",phone:"",date_of_birth:"",gender:null,address:"",city:"",state:"",country:"",postal_code:"",bio:""},this.showPassword=!1,this.showPasswordConfirmation=!1,this.avatarFile=null,(a=(e=this.$refs.userDialog)==null?void 0:e.resetValidation)==null||a.call(e)},async handleAvatarUpload(){var a;if(!this.avatarFile)return;const t=Array.isArray(this.avatarFile)?this.avatarFile[0]:this.avatarFile;if(!t)return;if(!t.type.startsWith("image/")){this.showError("Please select a valid image file"),this.avatarFile=null;return}const e=5*1024*1024;if(t.size>e){this.showError("File size must be less than 5MB"),this.avatarFile=null;return}this.uploadingAvatar=!0;try{const c=new FormData;c.append("image",t),c.append("folder","users"),this.form.name&&c.append("prefix",this.form.name);const o=localStorage.getItem("admin_token"),i=await this.$axios.post("/api/v1/upload/image",c,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}});if(i.data.success){const g=this.normalizeImageInput(i.data.path||i.data.url);this.form.avatar=g,this.avatarFile=null,this.showSuccess("Avatar uploaded successfully")}else throw new Error(i.data.message||"Failed to upload avatar")}catch(c){console.error("Error uploading avatar:",c);let o="Failed to upload avatar";c.response?o=((a=c.response.data)==null?void 0:a.message)||c.response.statusText||o:c.message&&(o=c.message),this.showError(o),this.avatarFile=null}finally{this.uploadingAvatar=!1}},clearAvatar(){this.form.avatar="",this.avatarFile=null},async saveUser(){var e,a,c,o,i;if(this.form.password&&this.form.password!==this.form.password_confirmation){this.showError("Passwords do not match");return}if(!this.editingUser&&!this.form.password){this.showError("Password is required for new users");return}if(this.editingUser&&this.form.password&&!this.form.password_confirmation){this.showError("Please confirm the password");return}if(!((e=this.$refs.userDialog)!=null&&e.validateForm)||this.$refs.userDialog.validateForm()){this.saving=!0;try{const g=localStorage.getItem("admin_token"),y=this.editingUser?`/api/v1/users/${this.editingUser.id}`:"/api/v1/users",_={...this.form};this.form.role_ids&&(_.role_ids=Array.isArray(this.form.role_ids)?this.form.role_ids:[this.form.role_ids]),this.form.password?_.password_confirmation=this.form.password_confirmation:(delete _.password,delete _.password_confirmation),_.avatar=this.normalizeImageInput(_.avatar),delete _.role;const v=this.editingUser?"put":"post";await axios[v](y,_,{headers:{Authorization:`Bearer ${g}`}}),this.showSuccess(this.editingUser?"User updated successfully":"User created successfully"),this.closeDialog(),await this.loadUsers()}catch(g){console.error("Error saving user:",g);let y="Error saving user";if((c=(a=g.response)==null?void 0:a.data)!=null&&c.errors){const _=g.response.data.errors,v=[];Object.keys(_).forEach(D=>{v.push(_[D][0])}),y=v.join(", ")}else(i=(o=g.response)==null?void 0:o.data)!=null&&i.message&&(y=g.response.data.message);this.showError(y)}finally{this.saving=!1}}},async deleteUser(t){if(t.id===this.currentUserId){this.showError("You cannot delete your own account");return}if(confirm(`Are you sure you want to delete ${t.name}?`))try{const e=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/users/${t.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("User deleted successfully"),await this.loadUsers()}catch(e){this.handleApiError(e,"Error deleting user")}},getRoleLabel(t){const e=this.roles.find(a=>a.slug===t);return e?e.label:t},getRoleColor(t){return{administrator:"error",editor:"primary","hr-user":"success",staff:"info"}[t]||"primary"},onPerPageChange(){this.resetPagination(),this.loadUsers()},onSort(t){this.handleSort(t),this.loadUsers()},normalizeImageInput(t){return W(t)},resolveImageUrl(t){return J(t)},formatDate(t){return te(t,"DD/MM/YYYY")},async viewUserProfile(t){try{const e=localStorage.getItem("admin_token"),a=await this.$axios.get(`/api/v1/users/${t.id}`,{headers:{Authorization:`Bearer ${e}`}});this.selectedUser=a.data,this.profileDialogVisible=!0}catch(e){console.error("Error loading user profile:",e),this.selectedUser=t,this.profileDialogVisible=!0,this.handleApiError(e,"Failed to load user profile details")}}}},he={class:"page-header"},ve={class:"text-caption text-grey"},ge={key:0},_e={class:"d-flex align-center"},ye={class:"d-flex align-center"},we={class:"d-flex align-center"},be={class:"d-flex align-center gap-2"},Ve={class:"d-flex flex-wrap gap-1"},Ue={class:"d-flex"},De={class:"d-flex align-center gap-2"},Pe={key:1,class:"text-white"},ke={key:0,class:"d-flex align-center"},Fe={key:1,class:"text-caption text-grey"},xe={key:0,class:"d-flex flex-column"},Ce={key:0,class:"text-body-2"},Se={key:1,class:"text-caption text-grey"},Ie={key:2,class:"text-caption text-grey"},Ae={key:1,class:"text-caption text-grey"},ze={key:0,class:"d-flex flex-wrap gap-1"},Me={key:1,class:"text-caption text-grey"},Te={key:0},Ee={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},Ye={class:"text-caption text-grey"},qe={key:0},Be={key:0,class:"ml-2"},Oe={key:1},Re={key:0,class:"d-flex align-center gap-2"};function Ne(t,e,a,c,o,i){const g=d("v-btn"),y=d("v-select"),_=d("v-col"),v=d("v-text-field"),D=d("v-row"),S=d("v-card-text"),x=d("v-card"),z=d("v-card-title"),P=d("v-icon"),w=d("v-skeleton-loader"),M=d("v-img"),T=d("v-avatar"),C=d("v-chip"),V=d("v-table"),E=d("v-pagination"),I=d("UserDialog"),Y=d("UserProfileDialog");return m(),p("div",null,[n("div",he,[e[15]||(e[15]=n("h1",{class:"text-h4 page-title"},"User Management",-1)),l(g,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=r=>i.openDialog(null)),class:"add-button"},{default:s(()=>e[14]||(e[14]=[f(" Add New User ")])),_:1,__:[14]})]),l(x,{class:"mb-4"},{default:s(()=>[l(S,null,{default:s(()=>[l(D,null,{default:s(()=>[l(_,{cols:"12",md:"2"},{default:s(()=>[l(y,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=r=>t.perPage=r),i.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(_,{cols:"12",md:"4"},{default:s(()=>[l(y,{modelValue:o.roleFilter,"onUpdate:modelValue":[e[2]||(e[2]=r=>o.roleFilter=r),i.loadUsers],items:o.roleOptions,label:"Filter by Role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(_,{cols:"12",md:"6"},{default:s(()=>[l(v,{modelValue:t.search,"onUpdate:modelValue":e[3]||(e[3]=r=>t.search=r),label:"Search by name, email, phone, city, or country","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:i.loadUsers},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,null,{default:s(()=>[l(z,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[17]||(e[17]=n("span",null,"Users",-1)),n("span",ve,[e[16]||(e[16]=f(" Total Records: ")),n("strong",null,h(t.pagination.total||0),1),o.users.length>0?(m(),p("span",ge," | Showing "+h((t.currentPage-1)*t.perPage+1)+" to "+h(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+h(t.pagination.total),1)):b("",!0)])]),_:1,__:[17]}),l(S,null,{default:s(()=>[l(V,null,{default:s(()=>[n("thead",null,[n("tr",null,[n("th",{class:"sortable",onClick:e[4]||(e[4]=r=>i.onSort("name"))},[n("div",_e,[e[18]||(e[18]=f(" Name ")),l(P,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),n("th",{class:"sortable",onClick:e[5]||(e[5]=r=>i.onSort("email"))},[n("div",ye,[e[19]||(e[19]=f(" Email ")),l(P,{icon:t.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[21]||(e[21]=n("th",null,"Phone",-1)),e[22]||(e[22]=n("th",null,"Location",-1)),e[23]||(e[23]=n("th",null,"Role",-1)),n("th",{class:"sortable",onClick:e[6]||(e[6]=r=>i.onSort("created_at"))},[n("div",we,[e[20]||(e[20]=f(" Created ")),l(P,{icon:t.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[24]||(e[24]=n("th",null,"Actions",-1))])]),n("tbody",null,[t.loading?(m(),p(A,{key:0},q(5,r=>n("tr",{key:`skeleton-${r}`},[n("td",null,[n("div",be,[l(w,{type:"avatar",width:"32",height:"32"}),l(w,{type:"text",width:"150"})])]),n("td",null,[l(w,{type:"text",width:"200"})]),n("td",null,[l(w,{type:"text",width:"120"})]),n("td",null,[l(w,{type:"text",width:"150"})]),n("td",null,[n("div",Ve,[l(w,{type:"chip",width:"80",height:"24",class:"mr-1"}),l(w,{type:"chip",width:"70",height:"24"})])]),n("td",null,[l(w,{type:"text",width:"120"})]),n("td",null,[n("div",Ue,[l(w,{type:"button",width:"32",height:"32",class:"mr-1"}),l(w,{type:"button",width:"32",height:"32"})])])])),64)):(m(),p(A,{key:1},[(m(!0),p(A,null,q(o.users,r=>(m(),p("tr",{key:r.id},[n("td",null,[n("div",De,[l(T,{size:"32",color:"primary"},{default:s(()=>[r.avatar?(m(),F(M,{key:0,src:r.avatar,alt:r.name},null,8,["src","alt"])):(m(),p("span",Pe,h(r.name.charAt(0).toUpperCase()),1))]),_:2},1024),f(" "+h(r.name),1)])]),n("td",null,h(r.email),1),n("td",null,[r.phone?(m(),p("span",ke,[l(P,{size:"small",class:"mr-1"},{default:s(()=>e[25]||(e[25]=[f("mdi-phone")])),_:1,__:[25]}),f(" "+h(r.phone),1)])):(m(),p("span",Fe,"-"))]),n("td",null,[r.city||r.country?(m(),p("div",xe,[r.city?(m(),p("span",Ce,h(r.city),1)):b("",!0),r.country?(m(),p("span",Se,h(r.country),1)):b("",!0),!r.city&&!r.country?(m(),p("span",Ie,"-")):b("",!0)])):(m(),p("span",Ae,"-"))]),n("td",null,[r.roles&&r.roles.length>0?(m(),p("div",ze,[(m(!0),p(A,null,q(r.roles,U=>(m(),F(C,{key:U.id,color:i.getRoleColor(U.slug),size:"small"},{default:s(()=>[f(h(U.name),1)]),_:2},1032,["color"]))),128))])):(m(),p("span",Me,"No roles"))]),n("td",null,h(i.formatDate(r.created_at)),1),n("td",null,[l(g,{size:"small",icon:"mdi-eye",onClick:U=>i.viewUserProfile(r),variant:"text",color:"info",title:"View Profile"},null,8,["onClick"]),l(g,{size:"small",icon:"mdi-pencil",onClick:U=>i.openDialog(r),variant:"text",title:"Edit User"},null,8,["onClick"]),l(g,{size:"small",icon:"mdi-delete",onClick:U=>i.deleteUser(r),variant:"text",color:"error",disabled:r.id===o.currentUserId,title:"Delete User"},null,8,["onClick","disabled"])])]))),128)),o.users.length===0?(m(),p("tr",Te,e[26]||(e[26]=[n("td",{colspan:"7",class:"text-center py-4"},"No users found",-1)]))):b("",!0)],64))])]),_:1}),n("div",Ee,[n("div",Ye,[o.users.length>0&&t.pagination.total>0?(m(),p("span",qe,[e[27]||(e[27]=f(" Showing ")),n("strong",null,h((t.currentPage-1)*t.perPage+1),1),e[28]||(e[28]=f(" to ")),n("strong",null,h(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[29]||(e[29]=f(" of ")),n("strong",null,h(t.pagination.total.toLocaleString()),1),e[30]||(e[30]=f(" records ")),t.pagination.last_page>1?(m(),p("span",Be," (Page "+h(t.currentPage)+" of "+h(t.pagination.last_page)+") ",1)):b("",!0)])):(m(),p("span",Oe," No records found "))]),t.pagination.last_page>1?(m(),p("div",Re,[l(E,{modelValue:t.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=r=>t.currentPage=r),i.loadUsers],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):b("",!0)])]),_:1})]),_:1}),l(I,{ref:"userDialog",modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=r=>o.dialog=r),"editing-user":o.editingUser,saving:o.saving,form:o.form,roles:o.roles,rules:o.rules,"active-tab":o.activeTab,"onUpdate:activeTab":e[9]||(e[9]=r=>o.activeTab=r),"gender-options":o.genderOptions,"show-password":o.showPassword,"onUpdate:showPassword":e[10]||(e[10]=r=>o.showPassword=r),"show-password-confirmation":o.showPasswordConfirmation,"onUpdate:showPasswordConfirmation":e[11]||(e[11]=r=>o.showPasswordConfirmation=r),"avatar-file":o.avatarFile,"onUpdate:avatarFile":e[12]||(e[12]=r=>o.avatarFile=r),"uploading-avatar":o.uploadingAvatar,"resolve-image-url":i.resolveImageUrl,onSave:i.saveUser,onClose:i.closeDialog,onClearAvatar:i.clearAvatar,onAvatarUpload:i.handleAvatarUpload},null,8,["modelValue","editing-user","saving","form","roles","rules","active-tab","gender-options","show-password","show-password-confirmation","avatar-file","uploading-avatar","resolve-image-url","onSave","onClose","onClearAvatar","onAvatarUpload"]),l(Y,{modelValue:o.profileDialogVisible,"onUpdate:modelValue":e[13]||(e[13]=r=>o.profileDialogVisible=r),user:o.selectedUser},null,8,["modelValue","user"])])}const We=B(fe,[["render",Ne],["__scopeId","data-v-90fa258a"]]);export{We as default};
